# Cloudflare Worker configuration for collab-todo
name = "collab-todo-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# nodejs_compat needed for some Node.js APIs
compatibility_flags = ["nodejs_compat"]

# Custom domain
routes = [
  { pattern = "api.collab-todo.metareflective.ink", custom_domain = true }
]

[vars]
# Set JWT_SECRET in dashboard or via wrangler secret
# JWT_SECRET = "change-me-in-production"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "collab-todo"
database_id = "707995a3-9863-47aa-b526-b92a60af131f"

# Durable Objects for realtime
[[durable_objects.bindings]]
name = "REALTIME"
class_name = "RealtimeDurableObject"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["RealtimeDurableObject"]

# Development settings
[dev]
port = 8787
local_protocol = "http"
